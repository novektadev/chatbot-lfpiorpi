const _0x3f65f1=_0x2615;(function(_0x290177,_0x1b29d8){const _0x5ce155=_0x2615,_0x1f6698=_0x290177();while(!![]){try{const _0x1337b6=-parseInt(_0x5ce155(0x1e2))/0x1*(-parseInt(_0x5ce155(0x1a9))/0x2)+parseInt(_0x5ce155(0x19c))/0x3+-parseInt(_0x5ce155(0x1b7))/0x4*(-parseInt(_0x5ce155(0x194))/0x5)+parseInt(_0x5ce155(0x1f4))/0x6+parseInt(_0x5ce155(0x1e1))/0x7*(-parseInt(_0x5ce155(0x1ee))/0x8)+-parseInt(_0x5ce155(0x195))/0x9*(parseInt(_0x5ce155(0x1c7))/0xa)+-parseInt(_0x5ce155(0x19b))/0xb;if(_0x1337b6===_0x1b29d8)break;else _0x1f6698['push'](_0x1f6698['shift']());}catch(_0x5c9370){_0x1f6698['push'](_0x1f6698['shift']());}}}(_0x22dd,0xd503e));import{bagOfWords,documentAsTree,stopWords,loadBagOfWords,loadDocumentAsTree,loadStopWords}from'./readModelData.js';import{contextModel,loadContextModel}from'./readModelData.js';async function displayDocumentTree(){const _0x48ce63=_0x2615;!documentAsTree&&(console[_0x48ce63(0x1c3)](_0x48ce63(0x1b8)),await loadDocumentAsTree());if(documentAsTree)for(const [_0x1a918,_0x2a6d59]of Object['entries'](documentAsTree)){const _0x590d32=_0x1a918,_0x380d00=_0x2a6d59;if(_0x380d00){const _0x47dc90=_0x380d00[_0x48ce63(0x1a1)],_0x5d6373=_0x380d00[_0x48ce63(0x1e0)];}}else console[_0x48ce63(0x1a0)]('documentAsTree\x20is\x20not\x20available.');}const calculateSimilarity=(_0x322426,_0x25fe8c)=>{const _0x15bde6=_0x2615,_0x3d58b8=_0x322426[_0x15bde6(0x1b5)]()[_0x15bde6(0x1c0)](/\s+/),_0x4a5ae0=_0x3d58b8['length'];if(_0x4a5ae0===0x0)return 0x0;const _0x2378fa=_0x3d58b8[_0x15bde6(0x1f3)]((_0x369095,_0x1cddff)=>_0x369095+(_0x25fe8c[_0x1cddff]||0x0),0x0);return _0x2378fa/_0x4a5ae0;};async function evaluateContext(_0x1fd029){const _0x1e1cfe=_0x2615;let _0x31c628=[];const _0x285b2d=(_0x240e79,_0x53b8ba)=>{const _0x313d69=_0x2615,_0x1e2d2b=_0x240e79[_0x313d69(0x1b9)];if(_0x1e2d2b===0x0)return 0x0;const _0x83acb5=_0x240e79[_0x313d69(0x1f3)]((_0x5d33ef,_0xd32eca)=>_0x5d33ef+(_0x53b8ba[_0xd32eca]||0x0),0x0);return _0x83acb5/_0x1e2d2b;};!contextModel&&(console['log'](_0x1e1cfe(0x1a3)),await loadContextModel());if(contextModel)for(const _0x4f3fc5 of contextModel){if(_0x4f3fc5&&Array[_0x1e1cfe(0x1bc)](_0x4f3fc5[_0x1e1cfe(0x1e8)]))for(const _0x29f145 of _0x4f3fc5[_0x1e1cfe(0x1e8)]){const _0x2cbe72=_0x29f145[_0x1e1cfe(0x1df)],_0x56ccf7=_0x29f145[_0x1e1cfe(0x19f)],_0x1b2835=_0x285b2d(_0x1fd029,_0x56ccf7);if(_0x1b2835>0x0){const _0x391054={'pathName':_0x4f3fc5[_0x1e1cfe(0x1be)],'chunkId':_0x2cbe72,'score':_0x1b2835};_0x31c628['push'](_0x391054);}}}else console[_0x1e1cfe(0x1a0)](_0x1e1cfe(0x1ba));return _0x31c628;}async function getVectorToSearch(_0x18daca){const _0x4aac4d=_0x2615,_0x523658=/[\u0300-\u036f]/g,_0x4308a0=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g,_0x4b76a5=/\s+/g,_0x2f83ee=_0x18daca[_0x4aac4d(0x1b5)]()['normalize'](_0x4aac4d(0x1f1))[_0x4aac4d(0x1ed)](_0x523658,''),_0x4e778d=_0x2f83ee['toLowerCase']()[_0x4aac4d(0x1ed)](_0x4308a0,'\x20'),_0x3b381d=_0x4e778d['replace'](_0x4b76a5,'\x20')['trim'](),_0x28a5e8=_0x3b381d[_0x4aac4d(0x1c0)]('\x20')[_0x4aac4d(0x1dd)](Boolean);!stopWords&&await loadStopWords();if(stopWords){let _0x5ab614=[];const _0x274377=new Set(stopWords);_0x5ab614[_0x4aac4d(0x1af)](..._0x28a5e8[_0x4aac4d(0x1dd)](_0x47b7ee=>!_0x274377[_0x4aac4d(0x1cb)](_0x47b7ee)));if(_0x5ab614['length']>=0x1){!bagOfWords&&await loadBagOfWords();if(bagOfWords){let _0x4cf4f1=[];const _0x4764d6=Object['keys'](bagOfWords),_0x340e6b=new Set(_0x4764d6);return _0x4cf4f1[_0x4aac4d(0x1af)](..._0x5ab614[_0x4aac4d(0x1dd)](_0x2b892c=>_0x340e6b[_0x4aac4d(0x1cb)](_0x2b892c))),_0x4cf4f1[_0x4aac4d(0x1b9)]>=0x1?_0x4cf4f1:null;}}}}async function getRelatedLeafs(_0x14b6da,_0x13a24c){const _0x4f8de6=_0x2615;let _0x3e6d95=null;const _0x1d342d=await evaluateContext(_0x14b6da);if(_0x1d342d){const _0xc6e1bd={};for(const _0xf778c2 of _0x1d342d){const _0x25718a=_0xf778c2[_0x4f8de6(0x1be)];!_0xc6e1bd[_0x25718a]&&(_0xc6e1bd[_0x25718a]={'chunksIds':new Set(),'totalScore':0x0,'entryCount':0x0,'maxScore':-Infinity});const _0xd151bf=_0xc6e1bd[_0x25718a];!_0xd151bf[_0x4f8de6(0x1cd)]['has'](_0xf778c2['chunkId'])&&(_0xd151bf['chunksIds'][_0x4f8de6(0x1a6)](_0xf778c2['chunkId']),_0xd151bf[_0x4f8de6(0x1ca)]+=_0xf778c2[_0x4f8de6(0x1d7)],_0xd151bf[_0x4f8de6(0x1e4)]++,_0xf778c2[_0x4f8de6(0x1d7)]>_0xd151bf[_0x4f8de6(0x1d3)]&&(_0xd151bf['maxScore']=_0xf778c2[_0x4f8de6(0x1d7)]));}const _0x553db4=Object[_0x4f8de6(0x197)](_0xc6e1bd)[_0x4f8de6(0x1f2)](([_0x3b2f45,_0x1c4532])=>{const _0x1025b1=_0x4f8de6,_0x4e9e9b=_0x1c4532[_0x1025b1(0x1ca)]/_0x1c4532[_0x1025b1(0x1e4)],_0x4d89cc=_0x1c4532[_0x1025b1(0x1d3)],_0x4d855d=(0x2*_0x4d89cc+_0x4e9e9b)/0x3;return{'pathName':_0x3b2f45,'numChunks':_0x1c4532[_0x1025b1(0x1cd)][_0x1025b1(0x1ea)],'avgScore':_0x4e9e9b,'maxScore':_0x4d89cc,'weightedAvg':_0x4d855d};});if(_0x553db4){if(_0x553db4[_0x4f8de6(0x1b9)]>=0x1)return _0x553db4['sort']((_0x32bc75,_0x495fed)=>{const _0x188f53=_0x4f8de6;if(_0x495fed[_0x188f53(0x199)]!==_0x32bc75[_0x188f53(0x199)])return _0x495fed[_0x188f53(0x199)]-_0x32bc75['weightedAvg'];return _0x495fed[_0x188f53(0x1c6)]-_0x32bc75[_0x188f53(0x1c6)];}),_0x3e6d95=_0x553db4['slice'](0x0,_0x13a24c),_0x3e6d95;}else return null;}else return null;}function _0x2615(_0x4313e6,_0x52c484){const _0x22dd6b=_0x22dd();return _0x2615=function(_0x261556,_0x5e7812){_0x261556=_0x261556-0x193;let _0x509ccd=_0x22dd6b[_0x261556];return _0x509ccd;},_0x2615(_0x4313e6,_0x52c484);}async function getResponsePaths(_0x58082f){const _0x1a6100=_0x2615,_0x5219ae=[];let _0x390388=0x1;for(const _0x2a7517 of _0x58082f){let _0x33d4c6=Array(0x8)[_0x1a6100(0x1cf)]('');const _0x2a7ba0=_0x2a7517[_0x1a6100(0x1be)]['split']('/');if(_0x2a7ba0){for(let _0x4e03b8=0x1;_0x4e03b8<_0x2a7ba0['length'];_0x4e03b8++){_0x4e03b8>0x1?_0x33d4c6[_0x4e03b8-0x1]=_0x33d4c6[_0x4e03b8-0x2]+'/'+_0x2a7ba0[_0x4e03b8]:_0x33d4c6[_0x4e03b8-0x1]='/'+_0x2a7ba0[_0x4e03b8];}_0x5219ae[_0x1a6100(0x1af)](_0x33d4c6);}_0x390388+=0x1;}return _0x5219ae;}async function getHTMLResponse(_0x109d15){const _0x28d288=_0x2615;if(_0x109d15['length']>=0x1){let _0x46d9bc='';for(let _0x5e3f91=0x0;_0x5e3f91<_0x109d15[_0x28d288(0x1b9)];_0x5e3f91++){for(let _0x237d9c=0x1;_0x237d9c<_0x109d15[_0x5e3f91][_0x28d288(0x1b9)];_0x237d9c++){const _0x18e2fc=_0x109d15[_0x5e3f91][_0x237d9c];if(_0x18e2fc!==''){let _0x55b4af='',_0x36dac3='';const _0x19a0d7=_0x18e2fc['split']('/'),_0x1d41c2=_0x19a0d7['at'](-0x1);!documentAsTree&&await loadDocumentAsTree();documentAsTree&&(_0x18e2fc in documentAsTree&&(_0x36dac3=documentAsTree[_0x18e2fc]['text']));if(_0x1d41c2!==_0x28d288(0x1dc)&&_0x1d41c2!=='U')switch(_0x237d9c){case 0x1:_0x55b4af=_0x28d288(0x1eb)+_0x1d41c2+_0x28d288(0x1d1)+_0x36dac3+_0x28d288(0x1aa);break;case 0x2:_0x55b4af=_0x28d288(0x1d0)+_0x1d41c2+'</b>\x20-\x20'+_0x36dac3+_0x28d288(0x1e9);break;case 0x3:_0x55b4af=_0x28d288(0x1b3)+_0x1d41c2+'</b>:\x20'+_0x36dac3+'</p>\x0a';break;case 0x4:_0x55b4af='<p\x20style=\x22padding-left:20px;\x22><b>'+_0x1d41c2+_0x28d288(0x1d1)+_0x36dac3+_0x28d288(0x1bb);break;case 0x5:_0x55b4af=_0x28d288(0x196)+_0x1d41c2+_0x28d288(0x1b2)+_0x36dac3+_0x28d288(0x1d9);break;case 0x6:_0x55b4af=_0x28d288(0x1d2)+_0x1d41c2+_0x28d288(0x1da)+_0x36dac3+')</p>\x0a';break;default:_0x55b4af=_0x36dac3+_0x28d288(0x1c4);break;}else _0x1d41c2===_0x28d288(0x1dc)&&(_0x55b4af=_0x28d288(0x1c9)+_0x36dac3+'}</i></p>\x0a'),_0x1d41c2=='U'&&(_0x55b4af='\x0a');_0x46d9bc+=_0x55b4af;}}_0x46d9bc+=_0x28d288(0x1c8);}return _0x46d9bc;}return null;}async function addMessageToChat(_0x17db0f,_0x156075){const _0x5e18b5=_0x2615;let _0x186cfa='';const _0x602204=document[_0x5e18b5(0x1ab)]('div');_0x156075==='user'&&(_0x186cfa=_0x5e18b5(0x1a5)+_0x17db0f+'</p>',_0x602204[_0x5e18b5(0x1de)]='message-bubble\x20user-message',_0x602204['style']=_0x5e18b5(0x19e)),_0x156075==='bot'&&(_0x186cfa=_0x5e18b5(0x1d5)+_0x17db0f,_0x602204[_0x5e18b5(0x1de)]=_0x5e18b5(0x1a4),_0x602204[_0x5e18b5(0x1e3)]=_0x5e18b5(0x1d8)),_0x156075===_0x5e18b5(0x1a2)&&(_0x186cfa=_0x5e18b5(0x193)+_0x17db0f+_0x5e18b5(0x1ac),_0x602204[_0x5e18b5(0x1de)]=_0x5e18b5(0x1a4),_0x602204[_0x5e18b5(0x1e3)]=_0x5e18b5(0x1db)),_0x156075===_0x5e18b5(0x1a8)&&(_0x186cfa=_0x5e18b5(0x193)+_0x17db0f+_0x5e18b5(0x1ac),_0x602204[_0x5e18b5(0x1de)]=_0x5e18b5(0x1a4),_0x602204['style']=_0x5e18b5(0x198)),_0x602204[_0x5e18b5(0x1a7)]=_0x186cfa,chatContainer[_0x5e18b5(0x1c2)](_0x602204),_0x602204[_0x5e18b5(0x1c1)]({'behavior':_0x5e18b5(0x1ce),'block':_0x5e18b5(0x1c5)});}async function sendMessage(){const _0x37c8bd=_0x2615,_0x1f0f79=userInput[_0x37c8bd(0x1bd)][_0x37c8bd(0x1f0)]();if(_0x1f0f79!==''){const _0x24fe01=await getVectorToSearch(_0x1f0f79);if(_0x24fe01!==null){if(_0x24fe01['length']>=0x3){addMessageToChat(_0x1f0f79,_0x37c8bd(0x19d));const _0x4b3226=document[_0x37c8bd(0x1b6)]('maxChunks'),_0x338e4f=await getRelatedLeafs(_0x24fe01,_0x4b3226[_0x37c8bd(0x1bd)]),_0x358271=await getResponsePaths(_0x338e4f),_0x4be366=await getHTMLResponse(_0x358271);addMessageToChat(_0x4be366,_0x37c8bd(0x1ae));}else addMessageToChat(_0x37c8bd(0x1d4),_0x37c8bd(0x1a2));}else addMessageToChat(_0x37c8bd(0x1ad)+_0x1f0f79+_0x37c8bd(0x1b0),'error');}}const currentTimeSpan=document[_0x3f65f1(0x1b6)](_0x3f65f1(0x1bf));function updateLocalTime(){const _0x4e1179=_0x3f65f1,_0x3c6186={'timeZone':'America/Mazatlan','hour':'numeric','minute':'numeric','second':_0x4e1179(0x1ec),'hour12':!![]},_0x356d64=new Date()[_0x4e1179(0x1b4)]('en-US',_0x3c6186);currentTimeSpan['textContent']=_0x356d64;}updateLocalTime(),setInterval(updateLocalTime,0x3e8);const chatContainer=document['getElementById']('chatContainer'),userInput=document[_0x3f65f1(0x1b6)]('userInput'),sendButton=document[_0x3f65f1(0x1b6)](_0x3f65f1(0x1ef)),typingIndicator=document[_0x3f65f1(0x1b6)]('typingIndicator'),maxChunksInput=document[_0x3f65f1(0x1b6)]('maxChunks'),queryExamples=document[_0x3f65f1(0x1e5)](_0x3f65f1(0x1e6));queryExamples[_0x3f65f1(0x1b9)]>=0x1&&queryExamples[_0x3f65f1(0x1d6)](_0x5e48b5=>{const _0x4d8b69=_0x3f65f1;_0x5e48b5[_0x4d8b69(0x1cc)](_0x4d8b69(0x1b1),_0x201f03=>{const _0x4194a9=_0x4d8b69;userInput[_0x4194a9(0x1bd)]=_0x5e48b5['dataset']['query'],sendMessage();});});;function _0x22dd(){const _0x253fa0=['scrollIntoView','appendChild','log','}<br>\x0a','end','numChunks','9670iwwDwz','<br>','<p><i>','totalScore','has','addEventListener','chunksIds','smooth','fill','<h4><b>Seccion\x20','</b>\x20-\x20','<p\x20style=\x22padding-left:60px;\x22><b>','maxScore','Para\x20darte\x20mejores\x20resultados,\x20necesito\x20más\x20detalles\x20en\x20tu\x20pregunta.\x20Por\x20favor,\x20añade\x20un\x20poco\x20más\x20de\x20contexto','<p><strong>Agente:</strong>\x20\x20Con\x20fundamento\x20en:</p>\x0a','forEach','score','background-color:\x20#e6f7ff;\x20padding:\x200.75rem;\x20border-radius:\x200.5rem;\x20margin-bottom:\x200.5rem;',')</p>\x0a','</b>\x20\x0a','background-color:\x20#f8ed62;\x20padding:\x200.75rem;\x20border-radius:\x200.5rem;\x20margin-bottom:\x200.5rem;','accion','filter','className','chunkId','text','14lDjqrw','1eaPpDg','style','entryCount','querySelectorAll','.example-btn','Enter','textChunks','</h4>\x0a','size','<h3><b>Capitulo\x20','numeric','replace','4479440aiivFE','sendButton','trim','NFD','map','reduce','7906188zaoQGs','<p><strong>Agente:</strong>','2495dOMFCS','15003kZYdOI','<p\x20style=\x22padding-left:40px;\x22><b>','entries','background-color:\x20#f69697;\x20padding:\x200.75rem;\x20border-radius:\x200.5rem;\x20margin-bottom:\x200.5rem;','weightedAvg','keypress','14610453IivnVR','3529128mwFyhU','user','background-color:\x20#dddddd;\x20padding:\x200.75rem;\x20border-radius:\x200.5rem;\x20margin-bottom:\x200.5rem;','chunk','warn','type','warning','Context\x20model\x20not\x20yet\x20loaded,\x20loading\x20now...','message-bubble\x20bot-message','<p><strong>usuario:</strong>\x20','add','innerHTML','error','2840098cFpTXh','\x20</h3>\x0a','createElement',':</p>','Su\x20consula\x20\x22<strong>','bot','push','\x22</strong>,\x20no\x20esta\x20relacionada\x20con\x20los\x20alcances\x20de\x20este\x20chatbot','click','</b>\x20','<p><b>Articulo\x20','toLocaleTimeString','toLowerCase','getElementById','8164DbLlmd','document\x20tree\x20not\x20yet\x20loaded,\x20loading\x20now...','length','documentAsTree\x20is\x20not\x20available.','</p>\x0a','isArray','value','pathName','currentTime','split'];_0x22dd=function(){return _0x253fa0;};return _0x22dd();}sendButton[_0x3f65f1(0x1cc)]('click',sendMessage),userInput[_0x3f65f1(0x1cc)](_0x3f65f1(0x19a),_0x195e63=>{const _0x529b3b=_0x3f65f1;if(_0x195e63['key']===_0x529b3b(0x1e7))sendMessage();});
